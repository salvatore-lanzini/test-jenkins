node{
    def app
        stage('Build'){
                echo "Running Build!"
                dir("test-jenkins"){
                    sh "mvn clean install -P dev -DskipTests"
                }
        }

        stage('Test'){
                echo "Test are skipped"
        }

        stage('Quality-Gate'){
                echo "Quality Gate are skipped! Test Poll"
        }

        stage('Build And Push Image'){
            dir("test-jenkins"){
                docker.withRegistry('https://registry.hub.docker.com','docker-hub'){
                    app = docker.build("slanzini/test-jenkins:1.0.0")
                    app.push()
                }
            }
        }

        stage('List pods') {
            withKubeCredentials([
                [credentialsId: 'kubectl-udm', serverUrl: 'https://10.206.195.55/k8s/clusters/c-zq4j8',
                 clusterName: 'giottodevk8s', contextName: 'giottodevk8s'],
                [credentialsId: 'kubectl-udm', serverUrl: 'https://10.206.195.41:6443',
                 clusterName: 'giottodevk8s-giottowrkawldev02', contextName: 'giottodevk8s-giottowrkawldev02']
            ]) {
              sh 'kubectl get pods -n udm'
            }
        }
}